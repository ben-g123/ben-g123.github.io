<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Parental Controls - Real Implementation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background-color: #cbd5e1;
            border-radius: 12px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .toggle-switch.active {
            background-color: #10b981;
        }
        
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background-color: white;
            border-radius: 50%;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }
        
        .blocked-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .time-warning {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .usage-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .usage-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }
        
        .usage-fill.warning {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }
        
        .usage-fill.danger {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }
        
        .blocked-site {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #991b1b;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Time Warning Notification -->
    <div id="timeWarning" class="time-warning">
        <div class="flex items-center space-x-2">
            <span class="text-xl">‚è∞</span>
            <div>
                <div class="font-semibold">Screen Time Warning</div>
                <div class="text-sm opacity-90" id="warningMessage">15 minutes remaining</div>
            </div>
        </div>
    </div>

    <!-- Blocked Overlay -->
    <div id="blockedOverlay" class="blocked-overlay">
        <div class="text-center">
            <div class="text-6xl mb-4">üö´</div>
            <h2 class="text-3xl font-bold mb-2">Access Blocked</h2>
            <p class="text-xl mb-6" id="blockReason">Screen time limit reached</p>
            <div class="bg-white bg-opacity-20 rounded-lg p-6 max-w-md">
                <p class="mb-4">To continue, please ask a parent to enter the unlock code:</p>
                <input type="password" id="unlockCode" placeholder="Enter unlock code" class="w-full px-4 py-2 rounded text-black text-center text-lg">
                <button onclick="checkUnlockCode()" class="w-full mt-3 bg-green-500 hover:bg-green-600 text-white py-2 rounded font-semibold">Unlock</button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Advanced Parental Controls</h1>
                    <p class="text-gray-600 mt-1">Real-time monitoring and control system</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-blue-600" id="activeUsers">2</div>
                        <div class="text-xs text-gray-600">Active Users</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-600" id="blockedAttempts">47</div>
                        <div class="text-xs text-gray-600">Blocked Today</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Main Controls -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Real-Time Screen Time Monitor -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">‚è±Ô∏è Live Screen Time Monitor</h2>
                    <div class="space-y-4">
                        <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium">Current Session</span>
                                <span class="text-lg font-bold text-blue-600" id="currentSession">00:00:00</span>
                            </div>
                            <div class="usage-bar">
                                <div class="usage-fill" id="sessionProgress" style="width: 0%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-600 mt-1">
                                <span>Started: <span id="sessionStart">--:--</span></span>
                                <span>Limit: <span id="sessionLimit">2h 00m</span></span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center p-3 bg-green-50 rounded-lg">
                                <div class="text-2xl font-bold text-green-600" id="todayTotal">1h 23m</div>
                                <div class="text-sm text-gray-600">Today Total</div>
                            </div>
                            <div class="text-center p-3 bg-orange-50 rounded-lg">
                                <div class="text-2xl font-bold text-orange-600" id="weekAverage">2h 15m</div>
                                <div class="text-sm text-gray-600">Week Average</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Website Monitoring -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üåê Website Activity Monitor</h2>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                                <span class="font-medium">Current Page:</span>
                                <span class="text-blue-600" id="currentUrl">parental-controls-dashboard</span>
                            </div>
                            <span class="text-sm text-gray-600" id="pageTime">2m 15s</span>
                        </div>
                        
                        <div class="space-y-2" id="recentSites">
                            <div class="flex items-center justify-between p-2 border-l-4 border-green-400 bg-green-50">
                                <span class="text-sm">google.com/search</span>
                                <span class="text-xs text-gray-600">5m ago</span>
                            </div>
                            <div class="flex items-center justify-between p-2 border-l-4 border-blue-400 bg-blue-50">
                                <span class="text-sm">wikipedia.org</span>
                                <span class="text-xs text-gray-600">12m ago</span>
                            </div>
                            <div class="flex items-center justify-between p-2 border-l-4 border-red-400 bg-red-50">
                                <span class="text-sm">youtube.com (BLOCKED)</span>
                                <span class="text-xs text-gray-600">18m ago</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Advanced Blocking Controls -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üõ°Ô∏è Advanced Content Filtering</h2>
                    <div class="space-y-4">
                        <!-- Keyword Blocking -->
                        <div class="p-4 border rounded-lg">
                            <h3 class="font-medium mb-3">Keyword Blocking</h3>
                            <div class="flex space-x-2 mb-3">
                                <input type="text" id="keywordInput" placeholder="Enter keyword to block" class="flex-1 px-3 py-2 border rounded-lg">
                                <button onclick="addBlockedKeyword()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Block</button>
                            </div>
                            <div class="flex flex-wrap gap-2" id="blockedKeywords">
                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">violence <button onclick="removeKeyword(this)" class="ml-1 text-red-600">√ó</button></span>
                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">inappropriate <button onclick="removeKeyword(this)" class="ml-1 text-red-600">√ó</button></span>
                            </div>
                        </div>

                        <!-- Time-based Restrictions -->
                        <div class="p-4 border rounded-lg">
                            <h3 class="font-medium mb-3">Time-based Website Access</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-1">Allow From:</label>
                                    <input type="time" id="allowFrom" value="09:00" class="w-full px-3 py-2 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-1">Allow Until:</label>
                                    <input type="time" id="allowUntil" value="18:00" class="w-full px-3 py-2 border rounded-lg">
                                </div>
                            </div>
                            <button onclick="updateTimeRestrictions()" class="mt-3 bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">Update Schedule</button>
                        </div>

                        <!-- URL Pattern Blocking -->
                        <div class="p-4 border rounded-lg">
                            <h3 class="font-medium mb-3">Advanced URL Blocking</h3>
                            <div class="space-y-2">
                                <input type="text" id="urlPatternInput" placeholder="Enter URL pattern (e.g., *.social-media.com)" class="w-full px-3 py-2 border rounded-lg">
                                <div class="flex space-x-2">
                                    <button onclick="addUrlPattern()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Block Pattern</button>
                                    <button onclick="testUrlPattern()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">Test Pattern</button>
                                </div>
                            </div>
                            <div class="mt-3 space-y-1" id="urlPatterns">
                                <div class="flex items-center justify-between bg-red-50 p-2 rounded">
                                    <span class="text-sm font-mono">*.tiktok.com</span>
                                    <button onclick="removeUrlPattern(this)" class="text-red-500 hover:text-red-700">‚úï</button>
                                </div>
                                <div class="flex items-center justify-between bg-red-50 p-2 rounded">
                                    <span class="text-sm font-mono">*gaming*</span>
                                    <button onclick="removeUrlPattern(this)" class="text-red-500 hover:text-red-700">‚úï</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar -->
            <div class="space-y-6">
                <!-- Time Limit Settings -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">‚è∞ Daily Time Limit</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Set Daily Limit:</label>
                            <div class="flex space-x-2">
                                <input type="number" id="limitHours" min="0" max="12" value="2" class="w-16 px-2 py-1 border rounded text-center">
                                <span class="py-1">hours</span>
                                <input type="number" id="limitMinutes" min="0" max="59" value="0" class="w-16 px-2 py-1 border rounded text-center">
                                <span class="py-1">minutes</span>
                            </div>
                        </div>
                        <button onclick="updateTimeLimit()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 font-medium">
                            Update Limit
                        </button>
                        <div class="text-xs text-gray-500 text-center">
                            Current limit: <span id="currentLimit">2h 00m</span>
                        </div>
                    </div>
                </div>

                <!-- Emergency Controls -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üö® Instant Controls</h2>
                    <div class="space-y-3">
                        <button onclick="emergencyPause()" class="w-full bg-red-500 text-white py-3 rounded-lg hover:bg-red-600 transition-colors font-medium">
                            üõë Emergency Stop
                        </button>
                        <button onclick="extendTime()" class="w-full bg-green-500 text-white py-3 rounded-lg hover:bg-green-600 transition-colors font-medium">
                            ‚è∞ Extend Time (+30min)
                        </button>
                        <button onclick="lockScreen()" class="w-full bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 transition-colors font-medium">
                            üîí Lock Screen Now
                        </button>
                        <button onclick="homeworkMode()" class="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 transition-colors font-medium">
                            üìö Homework Mode
                        </button>
                    </div>
                </div>

                <!-- Live Activity Feed -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìä Live Activity</h2>
                    <div class="space-y-3 max-h-64 overflow-y-auto" id="activityFeed">
                        <!-- Activity items will be added here -->
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üìà Today's Stats</h2>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Sites Visited:</span>
                            <span class="font-semibold" id="sitesVisited">23</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Blocks Triggered:</span>
                            <span class="font-semibold text-red-600" id="blocksTriggered">8</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Warnings Shown:</span>
                            <span class="font-semibold text-orange-600" id="warningsShown">3</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Productive Time:</span>
                            <span class="font-semibold text-green-600" id="productiveTime">45m</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Tab Switch Attempts:</span>
                            <span class="font-semibold text-red-600" id="tabSwitchCount">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Unlock Attempts:</span>
                            <span class="font-semibold text-orange-600" id="unlockAttemptsCount">0/5</span>
                        </div>
                        <div class="flex justify-between" id="lockoutStatus" style="display: none;">
                            <span class="text-gray-600">Lockout Remaining:</span>
                            <span class="font-semibold text-red-600" id="lockoutTime">--:--</span>
                        </div>
                    </div>
                </div>

                <!-- Unlock Codes -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">üîë Parent Access</h2>
                    <div class="space-y-3">
                        <div class="p-3 bg-gray-50 rounded-lg">
                            <div class="text-sm text-gray-600">Current Unlock Code:</div>
                            <div class="text-lg font-mono font-bold" id="currentUnlockCode">7429</div>
                        </div>
                        <button onclick="generateNewCode()" class="w-full bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 text-sm">
                            Generate New Code
                        </button>
                        <div class="text-xs text-gray-500">
                            Code changes every 24 hours automatically
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let sessionStartTime = new Date();
        let currentSessionSeconds = 0;
        let dailyLimitSeconds = 2 * 60 * 60; // 2 hours
        let isBlocked = false;
        let currentUnlockCode = "7429";
        let blockedKeywords = ["violence", "inappropriate"];
        let blockedUrlPatterns = ["*.tiktok.com", "*gaming*"];
        let timeRestrictions = { from: "09:00", until: "18:00" };
        
        // Real-time monitoring
        let monitoringInterval;
        let activityLog = [];
        let tabSwitchAttempts = 0;
        let isTabFocused = true;
        
        // Attempt limiting system
        let unlockAttempts = 0;
        let maxAttempts = 5;
        let lockoutEndTime = null;
        let lockoutTimer = null;

        // Initialize the system
        function initializeParentalControls() {
            loadDataFromStorage();
            startRealTimeMonitoring();
            updateDisplay();
            checkTimeRestrictions();
            monitorPageActivity();
            setupTabControlMonitoring();
            
            // Update every second
            setInterval(() => {
                currentSessionSeconds++;
                updateDisplay();
                checkLimits();
                saveDataToStorage();
            }, 1000);
            
            // Check for blocked content every 5 seconds
            setInterval(checkForBlockedContent, 5000);
            
            // Update activity feed every 10 seconds
            setInterval(updateActivityFeed, 10000);
            
            // Save data every 30 seconds
            setInterval(saveDataToStorage, 30000);
        }

        // Real-time monitoring functions
        function startRealTimeMonitoring() {
            // Monitor URL changes
            let lastUrl = window.location.href;
            setInterval(() => {
                if (window.location.href !== lastUrl) {
                    lastUrl = window.location.href;
                    logActivity('navigation', `Navigated to ${window.location.hostname}`);
                    checkForBlockedContent();
                }
            }, 1000);
            
            // Monitor page visibility
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    isTabFocused = false;
                    logActivity('focus', 'Page lost focus');
                    if (isBlocked) {
                        tabSwitchAttempts++;
                        logActivity('security', `Tab switch attempt #${tabSwitchAttempts} while blocked`);
                        showNotification('Tab switching blocked - returning focus', 'warning');
                        // Force focus back after a brief delay
                        setTimeout(() => {
                            window.focus();
                        }, 100);
                    }
                } else {
                    isTabFocused = true;
                    logActivity('focus', 'Page gained focus');
                }
            });
            
            // Monitor user input for inappropriate content (not dashboard controls)
            document.addEventListener('input', (e) => {
                // Only monitor actual user content inputs, not control interface
                if (e.target.matches('input[type="text"]:not([id*="keyword"]):not([id*="url"]):not([id*="unlock"]), textarea, [contenteditable="true"]')) {
                    setTimeout(checkForBlockedContent, 100);
                }
            });
        }

        function updateDisplay() {
            // Update session time
            const hours = Math.floor(currentSessionSeconds / 3600);
            const minutes = Math.floor((currentSessionSeconds % 3600) / 60);
            const seconds = currentSessionSeconds % 60;
            document.getElementById('currentSession').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update progress bar
            const progress = (currentSessionSeconds / dailyLimitSeconds) * 100;
            const progressBar = document.getElementById('sessionProgress');
            progressBar.style.width = `${Math.min(progress, 100)}%`;
            
            // Change color based on usage
            if (progress > 90) {
                progressBar.className = 'usage-fill danger';
            } else if (progress > 75) {
                progressBar.className = 'usage-fill warning';
            } else {
                progressBar.className = 'usage-fill';
            }
            
            // Update session start time
            document.getElementById('sessionStart').textContent = 
                sessionStartTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            // Update current URL
            document.getElementById('currentUrl').textContent = window.location.hostname || 'parental-controls-dashboard';
            
            // Update tab switch attempts counter
            document.getElementById('tabSwitchCount').textContent = tabSwitchAttempts;
        }

        function checkLimits() {
            const progress = (currentSessionSeconds / dailyLimitSeconds) * 100;
            
            // Show warnings
            if (progress >= 75 && progress < 90) {
                showTimeWarning('25% time remaining');
            } else if (progress >= 90 && progress < 100) {
                showTimeWarning('10% time remaining - prepare to finish up');
            } else if (progress >= 100) {
                triggerScreenLock('Screen time limit reached');
            }
        }

        function showTimeWarning(message) {
            const warning = document.getElementById('timeWarning');
            document.getElementById('warningMessage').textContent = message;
            warning.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                warning.style.display = 'none';
            }, 5000);
            
            logActivity('warning', message);
        }

        function checkForBlockedContent() {
            const currentUrl = window.location.href.toLowerCase();
            
            // Skip blocking on the parental controls dashboard itself
            if (currentUrl.includes('parental-controls') || currentUrl.includes('dashboard') || 
                document.title.includes('Parental Controls') || document.title.includes('Family Guardian')) {
                return; // Don't block the control interface
            }
            
            // Only check content in user-generated areas, not control interface
            const userContentAreas = document.querySelectorAll('input[type="text"], input[type="url"], textarea, [contenteditable="true"]');
            let userContent = '';
            userContentAreas.forEach(area => {
                userContent += area.value || area.textContent || '';
            });
            
            // Check blocked keywords only in user input areas
            for (let keyword of blockedKeywords) {
                if (userContent.toLowerCase().includes(keyword.toLowerCase())) {
                    // Show warning instead of blocking dashboard
                    showNotification(`Warning: Blocked keyword "${keyword}" detected in input`, 'warning');
                    logActivity('warning', `Blocked keyword detected in user input: ${keyword}`);
                    return;
                }
            }
            
            // Check URL patterns (but not for dashboard)
            for (let pattern of blockedUrlPatterns) {
                if (matchesPattern(currentUrl, pattern)) {
                    triggerContentBlock(`Blocked URL pattern: ${pattern}`);
                    return;
                }
            }
            
            // Check time restrictions (but allow dashboard access for parents)
            if (!isTimeAllowed() && !isParentAccess()) {
                triggerContentBlock('Outside allowed time window');
                return;
            }
        }

        function matchesPattern(url, pattern) {
            // Simple pattern matching (in real implementation, this would be more sophisticated)
            const regex = pattern.replace(/\*/g, '.*');
            return new RegExp(regex, 'i').test(url);
        }

        function isTimeAllowed() {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            
            const [fromHour, fromMin] = timeRestrictions.from.split(':').map(Number);
            const [untilHour, untilMin] = timeRestrictions.until.split(':').map(Number);
            
            const fromTime = fromHour * 60 + fromMin;
            const untilTime = untilHour * 60 + untilMin;
            
            return currentTime >= fromTime && currentTime <= untilTime;
        }

        function isParentAccess() {
            // Check if this is likely parent access (accessing control dashboard)
            return document.title.includes('Parental Controls') || 
                   document.title.includes('Family Guardian') ||
                   window.location.href.includes('dashboard') ||
                   window.location.href.includes('parental-controls');
        }

        function triggerContentBlock(reason) {
            if (isBlocked) return;
            
            isBlocked = true;
            document.getElementById('blockReason').textContent = reason;
            document.getElementById('blockedOverlay').style.display = 'flex';
            
            logActivity('block', reason);
            
            // Increment blocked attempts counter
            const counter = document.getElementById('blockedAttempts');
            counter.textContent = parseInt(counter.textContent) + 1;
        }

        function triggerScreenLock(reason) {
            triggerContentBlock(reason);
            
            // Additional restrictions for screen lock
            document.body.style.pointerEvents = 'none';
            document.body.style.userSelect = 'none';
            
            // Re-enable only the unlock overlay
            const overlay = document.getElementById('blockedOverlay');
            overlay.style.pointerEvents = 'auto';
        }

        function checkUnlockCode() {
            // Check if currently in lockout period
            if (lockoutEndTime && new Date() < lockoutEndTime) {
                const remainingTime = Math.ceil((lockoutEndTime - new Date()) / 1000 / 60);
                showNotification(`Browser locked for ${remainingTime} more minutes`, 'error');
                document.getElementById('unlockCode').value = '';
                return;
            }
            
            const enteredCode = document.getElementById('unlockCode').value;
            if (enteredCode === currentUnlockCode) {
                // Reset attempts on successful unlock
                unlockAttempts = 0;
                lockoutEndTime = null;
                if (lockoutTimer) {
                    clearInterval(lockoutTimer);
                    lockoutTimer = null;
                }
                
                // Check if this was a time limit related block
                const blockReason = document.getElementById('blockReason').textContent;
                const isTimeLimitBlock = blockReason.includes('time limit') || blockReason.includes('Time limit') || 
                                       blockReason.includes('Screen time') || blockReason.includes('limit reached');
                
                // Unlock successful
                isBlocked = false;
                document.getElementById('blockedOverlay').style.display = 'none';
                document.body.style.pointerEvents = 'auto';
                document.body.style.userSelect = 'auto';
                document.getElementById('unlockCode').value = '';
                
                // Reset emergency pause styles completely
                document.documentElement.style.cssText = '';
                document.body.style.cssText = '';
                
                // Show all hidden content
                Array.from(document.body.children).forEach(child => {
                    if (child.id !== 'blockedOverlay') {
                        child.style.display = '';
                    }
                });
                
                // Remove all event listeners that were blocking interactions
                document.removeEventListener('contextmenu', preventAll, true);
                document.removeEventListener('keydown', preventAllExceptUnlock, true);
                document.removeEventListener('keyup', preventAllExceptUnlock, true);
                document.removeEventListener('keypress', preventAllExceptUnlock, true);
                document.removeEventListener('selectstart', preventAll, true);
                document.removeEventListener('dragstart', preventAll, true);
                
                // Add 10 minutes grace time if it was a time limit block
                if (isTimeLimitBlock) {
                    dailyLimitSeconds += 10 * 60; // Add 10 minutes
                    document.getElementById('sessionLimit').textContent = formatTime(dailyLimitSeconds);
                    document.getElementById('currentLimit').textContent = formatTime(dailyLimitSeconds);
                    logActivity('unlock', 'Parent unlock successful - 10 minutes grace time added');
                    showNotification('Access granted! 10 minutes added for parent adjustments', 'success');
                    
                    // Show a special notification about the grace period
                    setTimeout(() => {
                        showNotification('Grace period: Use this time to adjust settings if needed', 'info');
                    }, 3000);
                } else {
                    logActivity('unlock', 'Parent unlock successful');
                    showNotification('Access granted by parent', 'success');
                }
                
                // Update unlock attempts display
                updateUnlockAttemptsDisplay();
            } else {
                // Wrong code - increment attempts
                unlockAttempts++;
                const remainingAttempts = maxAttempts - unlockAttempts;
                
                document.getElementById('unlockCode').value = '';
                document.getElementById('unlockCode').style.borderColor = '#ef4444';
                setTimeout(() => {
                    document.getElementById('unlockCode').style.borderColor = '';
                }, 2000);
                
                if (remainingAttempts > 0) {
                    logActivity('unlock_failed', `Invalid unlock code entered - ${remainingAttempts} attempts remaining`);
                    showNotification(`Invalid code! ${remainingAttempts} attempts remaining`, 'error');
                } else {
                    // All attempts used - trigger 10 minute lockout
                    startLockoutPeriod();
                }
                
                updateUnlockAttemptsDisplay();
            }
        }

        // Emergency controls
        function emergencyPause() {
            // Immediate full screen lock with no inspection possible
            document.documentElement.style.cssText = 'position:fixed!important;top:0!important;left:0!important;width:100%!important;height:100%!important;background:#000!important;z-index:999999!important;';
            document.body.style.cssText = 'position:fixed!important;top:0!important;left:0!important;width:100%!important;height:100%!important;background:#000!important;z-index:999999!important;overflow:hidden!important;';
            
            // Disable all interactions except unlock input
            document.addEventListener('contextmenu', preventAll, true);
            document.addEventListener('keydown', preventAllExceptUnlock, true);
            document.addEventListener('keyup', preventAllExceptUnlock, true);
            document.addEventListener('keypress', preventAllExceptUnlock, true);
            document.addEventListener('selectstart', preventAll, true);
            document.addEventListener('dragstart', preventAll, true);
            
            // Hide all content and show only unlock
            Array.from(document.body.children).forEach(child => {
                if (child.id !== 'blockedOverlay') {
                    child.style.display = 'none';
                }
            });
            
            triggerScreenLock('Emergency pause activated by parent');
            logActivity('emergency', 'Emergency pause activated');
            showNotification('Emergency pause activated', 'warning');
        }
        
        function preventAll(e) {
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
        }
        
        function preventAllExceptUnlock(e) {
            // Allow typing in unlock code input and Enter key
            if (e.target && e.target.id === 'unlockCode') {
                return true; // Allow normal input behavior
            }
            if (e.key === 'Enter' && document.activeElement && document.activeElement.id === 'unlockCode') {
                return true; // Allow Enter to submit unlock code
            }
            
            e.preventDefault();
            e.stopPropagation();
            e.stopImmediatePropagation();
            return false;
        }

        function updateTimeLimit() {
            const hours = parseInt(document.getElementById('limitHours').value) || 0;
            const minutes = parseInt(document.getElementById('limitMinutes').value) || 0;
            
            if (hours === 0 && minutes === 0) {
                showNotification('Time limit cannot be zero', 'error');
                return;
            }
            
            dailyLimitSeconds = (hours * 60 * 60) + (minutes * 60);
            
            // Update displays
            document.getElementById('sessionLimit').textContent = formatTime(dailyLimitSeconds);
            document.getElementById('currentLimit').textContent = formatTime(dailyLimitSeconds);
            
            logActivity('config', `Daily time limit updated to ${hours}h ${minutes}m`);
            showNotification(`Daily limit set to ${hours}h ${minutes}m`, 'success');
            
            // Check if current session exceeds new limit
            if (currentSessionSeconds >= dailyLimitSeconds) {
                triggerScreenLock('New time limit exceeded');
            }
        }

        function extendTime() {
            dailyLimitSeconds += 30 * 60; // Add 30 minutes
            document.getElementById('sessionLimit').textContent = formatTime(dailyLimitSeconds);
            document.getElementById('currentLimit').textContent = formatTime(dailyLimitSeconds);
            logActivity('extend', 'Time extended by 30 minutes');
            showNotification('Time extended by 30 minutes', 'success');
        }

        function lockScreen() {
            triggerScreenLock('Screen locked by parent');
            logActivity('lock', 'Screen locked by parent');
        }

        function homeworkMode() {
            // In homework mode, only allow educational sites
            blockedUrlPatterns = [...blockedUrlPatterns, '*social*', '*gaming*', '*entertainment*'];
            logActivity('homework', 'Homework mode activated');
            showNotification('Homework mode activated - only educational sites allowed', 'info');
        }

        // Keyword management
        function addBlockedKeyword() {
            const input = document.getElementById('keywordInput');
            const keyword = input.value.trim();
            if (keyword && !blockedKeywords.includes(keyword)) {
                blockedKeywords.push(keyword);
                updateBlockedKeywordsDisplay();
                input.value = '';
                logActivity('config', `Added blocked keyword: ${keyword}`);
                showNotification(`Keyword "${keyword}" blocked`, 'success');
            }
        }

        function removeKeyword(button) {
            const keyword = button.parentElement.textContent.replace(' √ó', '');
            blockedKeywords = blockedKeywords.filter(k => k !== keyword);
            updateBlockedKeywordsDisplay();
            logActivity('config', `Removed blocked keyword: ${keyword}`);
            showNotification(`Keyword "${keyword}" unblocked`, 'info');
        }

        function updateBlockedKeywordsDisplay() {
            const container = document.getElementById('blockedKeywords');
            container.innerHTML = blockedKeywords.map(keyword => 
                `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">${keyword} <button onclick="removeKeyword(this)" class="ml-1 text-red-600">√ó</button></span>`
            ).join('');
        }

        // URL pattern management
        function addUrlPattern() {
            const input = document.getElementById('urlPatternInput');
            const pattern = input.value.trim();
            if (pattern && !blockedUrlPatterns.includes(pattern)) {
                blockedUrlPatterns.push(pattern);
                updateUrlPatternsDisplay();
                input.value = '';
                logActivity('config', `Added URL pattern: ${pattern}`);
                showNotification(`URL pattern "${pattern}" blocked`, 'success');
            }
        }

        function removeUrlPattern(button) {
            const pattern = button.parentElement.querySelector('span').textContent;
            blockedUrlPatterns = blockedUrlPatterns.filter(p => p !== pattern);
            updateUrlPatternsDisplay();
            logActivity('config', `Removed URL pattern: ${pattern}`);
            showNotification(`URL pattern "${pattern}" unblocked`, 'info');
        }

        function updateUrlPatternsDisplay() {
            const container = document.getElementById('urlPatterns');
            container.innerHTML = blockedUrlPatterns.map(pattern => 
                `<div class="flex items-center justify-between bg-red-50 p-2 rounded">
                    <span class="text-sm font-mono">${pattern}</span>
                    <button onclick="removeUrlPattern(this)" class="text-red-500 hover:text-red-700">‚úï</button>
                </div>`
            ).join('');
        }

        function testUrlPattern() {
            const pattern = document.getElementById('urlPatternInput').value.trim();
            const testUrl = prompt('Enter URL to test against pattern:');
            if (testUrl && pattern) {
                const matches = matchesPattern(testUrl, pattern);
                showNotification(
                    matches ? `URL matches pattern "${pattern}"` : `URL does not match pattern "${pattern}"`,
                    matches ? 'warning' : 'info'
                );
            }
        }

        // Time restrictions
        function updateTimeRestrictions() {
            timeRestrictions.from = document.getElementById('allowFrom').value;
            timeRestrictions.until = document.getElementById('allowUntil').value;
            logActivity('config', `Updated time restrictions: ${timeRestrictions.from} - ${timeRestrictions.until}`);
            showNotification('Time restrictions updated', 'success');
            checkTimeRestrictions();
        }

        function checkTimeRestrictions() {
            if (!isTimeAllowed()) {
                triggerContentBlock('Outside allowed time window');
            }
        }

        // Activity logging and monitoring
        function logActivity(type, message) {
            const activity = {
                timestamp: new Date(),
                type: type,
                message: message
            };
            activityLog.unshift(activity);
            
            // Keep only last 50 activities
            if (activityLog.length > 50) {
                activityLog = activityLog.slice(0, 50);
            }
        }

        function updateActivityFeed() {
            const feed = document.getElementById('activityFeed');
            const recentActivities = activityLog.slice(0, 10);
            
            feed.innerHTML = recentActivities.map(activity => {
                const timeStr = activity.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                const typeColors = {
                    'block': 'border-red-400 bg-red-50',
                    'warning': 'border-orange-400 bg-orange-50',
                    'navigation': 'border-blue-400 bg-blue-50',
                    'config': 'border-green-400 bg-green-50',
                    'unlock': 'border-purple-400 bg-purple-50',
                    'emergency': 'border-red-600 bg-red-100'
                };
                
                return `
                    <div class="flex items-start space-x-2 p-2 border-l-4 ${typeColors[activity.type] || 'border-gray-400 bg-gray-50'} rounded">
                        <div class="flex-1">
                            <p class="text-sm font-medium">${activity.message}</p>
                            <p class="text-xs text-gray-500">${timeStr}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function monitorPageActivity() {
            let pageStartTime = Date.now();
            
            setInterval(() => {
                const timeOnPage = Math.floor((Date.now() - pageStartTime) / 1000);
                const minutes = Math.floor(timeOnPage / 60);
                const seconds = timeOnPage % 60;
                document.getElementById('pageTime').textContent = `${minutes}m ${seconds}s`;
            }, 1000);
        }

        // Utility functions
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return `${hours}h ${minutes.toString().padStart(2, '0')}m`;
        }

        function generateNewCode() {
            currentUnlockCode = Math.floor(1000 + Math.random() * 9000).toString();
            document.getElementById('currentUnlockCode').textContent = currentUnlockCode;
            logActivity('config', 'New unlock code generated');
            showNotification('New unlock code generated', 'info');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'bg-green-500',
                warning: 'bg-orange-500',
                info: 'bg-blue-500',
                error: 'bg-red-500'
            };
            
            notification.className = `fixed bottom-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-y-full transition-transform duration-300`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateY(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateY(full)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Keyboard shortcuts for parents and security
        document.addEventListener('keydown', (e) => {
            // Block developer tools and inspection
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C' || e.key === 'J')) ||
                (e.ctrlKey && e.key === 'u') ||
                (e.ctrlKey && e.shiftKey && e.key === 'K')) {
                e.preventDefault();
                e.stopPropagation();
                showNotification('Developer tools blocked by parental controls', 'error');
                logActivity('security', 'Attempted to access developer tools');
                return false;
            }
            
            // Ctrl+Shift+P for emergency pause
            if (e.ctrlKey && e.shiftKey && e.key === 'P') {
                e.preventDefault();
                emergencyPause();
            }
            
            // Ctrl+Shift+U for unlock prompt
            if (e.ctrlKey && e.shiftKey && e.key === 'U') {
                e.preventDefault();
                const code = prompt('Enter unlock code:');
                if (code === currentUnlockCode) {
                    if (isBlocked) {
                        isBlocked = false;
                        document.getElementById('blockedOverlay').style.display = 'none';
                        document.body.style.pointerEvents = 'auto';
                        document.body.style.userSelect = 'auto';
                        // Reset emergency pause styles
                        document.documentElement.style.cssText = '';
                        document.body.style.cssText = '';
                        Array.from(document.body.children).forEach(child => {
                            child.style.display = '';
                        });
                    }
                    showNotification('Quick unlock successful', 'success');
                }
            }
        });

        // Lockout period functions
        function startLockoutPeriod() {
            lockoutEndTime = new Date(Date.now() + 10 * 60 * 1000); // 10 minutes from now
            
            // Disable unlock input completely
            const unlockInput = document.getElementById('unlockCode');
            unlockInput.disabled = true;
            unlockInput.placeholder = 'Browser locked for 10 minutes';
            unlockInput.style.backgroundColor = '#fee2e2';
            unlockInput.style.color = '#991b1b';
            
            // Update block reason
            document.getElementById('blockReason').textContent = 'Too many failed unlock attempts - Browser locked for 10 minutes';
            
            // Start countdown timer
            lockoutTimer = setInterval(() => {
                const now = new Date();
                if (now >= lockoutEndTime) {
                    // Lockout period ended
                    clearInterval(lockoutTimer);
                    lockoutTimer = null;
                    lockoutEndTime = null;
                    unlockAttempts = 0;
                    
                    // Re-enable unlock input
                    unlockInput.disabled = false;
                    unlockInput.placeholder = 'Enter unlock code';
                    unlockInput.style.backgroundColor = '';
                    unlockInput.style.color = '';
                    
                    // Update display
                    document.getElementById('blockReason').textContent = 'Access blocked - Enter unlock code to continue';
                    updateUnlockAttemptsDisplay();
                    
                    logActivity('lockout', 'Lockout period ended - unlock attempts reset');
                    showNotification('Lockout period ended. You may try again.', 'info');
                } else {
                    // Update countdown display
                    updateLockoutDisplay();
                }
            }, 1000);
            
            logActivity('lockout', 'Browser locked for 10 minutes due to failed unlock attempts');
            showNotification('Too many failed attempts! Browser locked for 10 minutes.', 'error');
            updateUnlockAttemptsDisplay();
        }
        
        function updateLockoutDisplay() {
            if (lockoutEndTime) {
                const remaining = Math.max(0, lockoutEndTime - new Date());
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('lockoutTime').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('lockoutStatus').style.display = 'flex';
            } else {
                document.getElementById('lockoutStatus').style.display = 'none';
            }
        }
        
        function updateUnlockAttemptsDisplay() {
            document.getElementById('unlockAttemptsCount').textContent = `${unlockAttempts}/${maxAttempts}`;
            
            // Change color based on attempts
            const attemptsElement = document.getElementById('unlockAttemptsCount');
            if (unlockAttempts >= maxAttempts) {
                attemptsElement.className = 'font-semibold text-red-600';
            } else if (unlockAttempts >= 3) {
                attemptsElement.className = 'font-semibold text-orange-600';
            } else {
                attemptsElement.className = 'font-semibold text-green-600';
            }
            
            updateLockoutDisplay();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            initializeParentalControls();
            updateBlockedKeywordsDisplay();
            updateUrlPatternsDisplay();
            updateUnlockAttemptsDisplay();
            
            // Block right-click context menu
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                showNotification('Right-click blocked by parental controls', 'warning');
                logActivity('security', 'Right-click context menu blocked');
                return false;
            });
            
            // Block text selection in locked mode
            document.addEventListener('selectstart', (e) => {
                if (isBlocked) {
                    e.preventDefault();
                    return false;
                }
            });
            
            // Monitor for console access attempts
            let devtools = {open: false, orientation: null};
            const threshold = 160;
            setInterval(() => {
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    if (!devtools.open) {
                        devtools.open = true;
                        showNotification('Developer tools detected - access blocked', 'error');
                        logActivity('security', 'Developer tools opened');
                        emergencyPause();
                    }
                } else {
                    devtools.open = false;
                }
            }, 500);
            
            // Simulate some initial activity
            setTimeout(() => {
                logActivity('system', 'Parental controls system started');
                logActivity('navigation', 'Dashboard loaded');
            }, 1000);
        });

        // Tab control and monitoring functions
        function setupTabControlMonitoring() {
            // Prevent tab switching when blocked
            document.addEventListener('keydown', (e) => {
                if (isBlocked && (
                    (e.ctrlKey && (e.key === 'Tab' || e.key === 't' || e.key === 'w')) ||
                    (e.altKey && e.key === 'Tab') ||
                    (e.ctrlKey && e.shiftKey && e.key === 'Tab')
                )) {
                    e.preventDefault();
                    e.stopPropagation();
                    tabSwitchAttempts++;
                    logActivity('security', `Keyboard tab switch attempt #${tabSwitchAttempts} blocked`);
                    showNotification('Tab switching blocked by parental controls', 'error');
                    return false;
                }
            });
            
            // Monitor for window blur (user clicking elsewhere)
            window.addEventListener('blur', () => {
                if (isBlocked) {
                    setTimeout(() => {
                        window.focus();
                        logActivity('security', 'Window focus restored after blur attempt');
                    }, 50);
                }
            });
            
            // Prevent new window/tab opening when blocked
            window.addEventListener('beforeunload', (e) => {
                if (isBlocked) {
                    tabSwitchAttempts++;
                    const message = 'Parental Controls: Tab closing blocked. This attempt has been logged.';
                    logActivity('security', `Tab close attempt #${tabSwitchAttempts} - blocked and logged`);
                    saveDataToStorage(); // Save immediately before potential close
                    e.preventDefault();
                    e.returnValue = message;
                    
                    // Show alert and keep focus
                    setTimeout(() => {
                        alert('Tab closing is blocked by parental controls. This attempt has been logged and parents will be notified.');
                        window.focus();
                    }, 100);
                    
                    return message;
                } else {
                    logActivity('system', 'Session ended normally');
                    saveDataToStorage();
                }
            });
        }

        // Local storage functions
        function saveDataToStorage() {
            try {
                const data = {
                    sessionStartTime: sessionStartTime.toISOString(),
                    currentSessionSeconds: currentSessionSeconds,
                    dailyLimitSeconds: dailyLimitSeconds,
                    currentUnlockCode: currentUnlockCode,
                    blockedKeywords: blockedKeywords,
                    blockedUrlPatterns: blockedUrlPatterns,
                    timeRestrictions: timeRestrictions,
                    activityLog: activityLog,
                    tabSwitchAttempts: tabSwitchAttempts,
                    unlockAttempts: unlockAttempts,
                    lockoutEndTime: lockoutEndTime ? lockoutEndTime.toISOString() : null,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('parentalControlsData', JSON.stringify(data));
            } catch (error) {
                console.error('Failed to save data to localStorage:', error);
                logActivity('error', 'Failed to save session data');
            }
        }

        function loadDataFromStorage() {
            try {
                const savedData = localStorage.getItem('parentalControlsData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // Restore session data
                    if (data.sessionStartTime) {
                        sessionStartTime = new Date(data.sessionStartTime);
                    }
                    if (data.currentSessionSeconds) {
                        currentSessionSeconds = data.currentSessionSeconds;
                    }
                    if (data.dailyLimitSeconds) {
                        dailyLimitSeconds = data.dailyLimitSeconds;
                    }
                    if (data.currentUnlockCode) {
                        currentUnlockCode = data.currentUnlockCode;
                    }
                    if (data.blockedKeywords) {
                        blockedKeywords = data.blockedKeywords;
                    }
                    if (data.blockedUrlPatterns) {
                        blockedUrlPatterns = data.blockedUrlPatterns;
                    }
                    if (data.timeRestrictions) {
                        timeRestrictions = data.timeRestrictions;
                    }
                    if (data.activityLog) {
                        activityLog = data.activityLog.map(activity => ({
                            ...activity,
                            timestamp: new Date(activity.timestamp)
                        }));
                    }
                    if (data.tabSwitchAttempts) {
                        tabSwitchAttempts = data.tabSwitchAttempts;
                    }
                    if (data.unlockAttempts) {
                        unlockAttempts = data.unlockAttempts;
                    }
                    if (data.lockoutEndTime) {
                        lockoutEndTime = new Date(data.lockoutEndTime);
                        // If lockout is still active, restart the timer
                        if (lockoutEndTime > new Date()) {
                            const unlockInput = document.getElementById('unlockCode');
                            unlockInput.disabled = true;
                            unlockInput.placeholder = 'Browser locked for 10 minutes';
                            unlockInput.style.backgroundColor = '#fee2e2';
                            unlockInput.style.color = '#991b1b';
                            
                            lockoutTimer = setInterval(() => {
                                const now = new Date();
                                if (now >= lockoutEndTime) {
                                    clearInterval(lockoutTimer);
                                    lockoutTimer = null;
                                    lockoutEndTime = null;
                                    unlockAttempts = 0;
                                    
                                    unlockInput.disabled = false;
                                    unlockInput.placeholder = 'Enter unlock code';
                                    unlockInput.style.backgroundColor = '';
                                    unlockInput.style.color = '';
                                    
                                    updateUnlockAttemptsDisplay();
                                    logActivity('lockout', 'Lockout period ended after page reload');
                                } else {
                                    updateLockoutDisplay();
                                }
                            }, 1000);
                        } else {
                            // Lockout period has expired
                            lockoutEndTime = null;
                            unlockAttempts = 0;
                        }
                    }
                    
                    logActivity('system', 'Session data restored from storage');
                    
                    // Update UI elements
                    document.getElementById('limitHours').value = Math.floor(dailyLimitSeconds / 3600);
                    document.getElementById('limitMinutes').value = Math.floor((dailyLimitSeconds % 3600) / 60);
                    document.getElementById('allowFrom').value = timeRestrictions.from;
                    document.getElementById('allowUntil').value = timeRestrictions.until;
                    document.getElementById('currentUnlockCode').textContent = currentUnlockCode;
                }
            } catch (error) {
                console.error('Failed to load data from localStorage:', error);
                logActivity('error', 'Failed to load session data');
            }
        }

        // Clear storage function (for testing or reset)
        function clearStoredData() {
            localStorage.removeItem('parentalControlsData');
            logActivity('system', 'Stored data cleared');
            showNotification('All stored data cleared', 'info');
        }

        // Handle page unload
        window.addEventListener('beforeunload', () => {
            if (!isBlocked) {
                logActivity('system', 'Session ended');
                saveDataToStorage();
            }
        });

        // Allow Enter key for inputs
        document.getElementById('keywordInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addBlockedKeyword();
        });
        
        document.getElementById('urlPatternInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addUrlPattern();
        });
        
        document.getElementById('unlockCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkUnlockCode();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97897cfed15829b9',t:'MTc1Njc3OTIwNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
